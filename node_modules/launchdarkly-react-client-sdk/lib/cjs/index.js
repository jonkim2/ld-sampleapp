"use strict";var e=require("react"),t=require("launchdarkly-js-client-sdk"),r=require("lodash.camelcase"),n=require("hoist-non-react-statics");function o(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var s=o(e);const a={useCamelCaseFlagKeys:!0,sendEventsOnFlagRead:!0},i=e.createContext({flags:{},flagKeyMap:{},ldClient:void 0}),{Provider:l,Consumer:c}=i,u=e=>{var t;return null!=(t=e.context)?t:e.user},p=e=>{const t={};for(const n in e)0!==n.indexOf("$")&&(t[r(n)]=e[n]);return t},f=(e,t)=>{const r={};for(const n in e)t&&void 0===t[n]||(r[n]=e[n].current);return r},y=(e,t)=>{const r=e.allFlags();return t?Object.keys(t).reduce(((e,n)=>(e[n]=Object.prototype.hasOwnProperty.call(r,n)?r[n]:t[n],e)),{}):r};p.camelCaseKeys=p;var d=Object.defineProperty,b=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,h=(e,t,r)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,v=(e,t)=>{for(var r in t||(t={}))g.call(t,r)&&h(e,r,t[r]);if(b)for(var r of b(t))O.call(t,r)&&h(e,r,t[r]);return e};const m={wrapperName:"react-client-sdk",wrapperVersion:"3.0.9",sendEventsOnlyForVariation:!0},j=(e,...r)=>{return n=void 0,o=[e,...r],s=function*(e,r={anonymous:!0,kind:"user"},n,o){const s=t.initialize(e,r,v(v({},m),n));return new Promise((e=>{function t(){s.off("ready",n),s.off("failed",r)}function r(r){t(),e({flags:{},ldClient:s,error:r})}function n(){t();const r=y(s,o);e({flags:r,ldClient:s})}s.on("failed",r),s.on("ready",n)}))},new Promise(((e,t)=>{var r=e=>{try{i(s.next(e))}catch(e){t(e)}},a=e=>{try{i(s.throw(e))}catch(e){t(e)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(r,a);i((s=s.apply(n,o)).next())}));var n,o,s};function C(e,t,n=a,o){const s=function(e,t){if(void 0===t)return e;return Object.keys(t).reduce(((t,r)=>(P(e,r)&&(t[r]=e[r]),t)),{})}(t,o),{useCamelCaseFlagKeys:i=!0}=n,[l,c={}]=i?function(e){const t={},n={};for(const o in e){if(0===o.indexOf("$"))continue;const s=r(o);t[s]=e[o],n[s]=o}return[t,n]}(s):[s];return{flags:n.sendEventsOnFlagRead?x(e,l,c,i):l,flagKeyMap:c}}function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function x(e,t,r,n){return new Proxy(t,{get(t,o,s){const a=Reflect.get(t,o,s),i=n&&P(r,o)||P(t,o);if("symbol"==typeof o||!i)return a;if(void 0===a)return;const l=n?r[o]:o;return e.variation(l,a)}})}var w=Object.defineProperty,E=Object.defineProperties,F=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertySymbols,K=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,k=(e,t,r)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,I=(e,t)=>{for(var r in t||(t={}))K.call(t,r)&&k(e,r,t[r]);if(D)for(var r of D(t))S.call(t,r)&&k(e,r,t[r]);return e},L=(e,t,r)=>(k(e,"symbol"!=typeof t?t+"":t,r),r),M=(e,t,r)=>new Promise(((n,o)=>{var s=e=>{try{i(r.next(e))}catch(e){o(e)}},a=e=>{try{i(r.throw(e))}catch(e){o(e)}},i=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,a);i((r=r.apply(e,t)).next())}));class R extends e.Component{constructor(e){super(e),L(this,"state"),L(this,"getReactOptions",(()=>I(I({},a),this.props.reactOptions))),L(this,"subscribeToChanges",(e=>{const{flags:t}=this.props;e.on("change",(r=>{const n=this.getReactOptions(),o=f(r,t),s=I(I({},this.state.unproxiedFlags),o);Object.keys(o).length>0&&this.setState(I({unproxiedFlags:s},C(e,s,n,t)))}))})),L(this,"initLDClient",(()=>M(this,null,(function*(){const{clientSideID:e,flags:t,options:r}=this.props;let n=yield this.props.ldClient;const o=this.getReactOptions();let s,a=this.state.unproxiedFlags;if(n)a=y(n,t);else{const o=yield j(e,u(this.props),r,t);s=o.error,s||(a=o.flags),n=o.ldClient}var i;this.setState((i=I({unproxiedFlags:a},C(n,a,o,t)),E(i,F({ldClient:n,error:s})))),this.subscribeToChanges(n)}))));const{options:t}=e;if(this.state={flags:{},unproxiedFlags:{},flagKeyMap:{},ldClient:void 0},t){const{bootstrap:e}=t;if(e&&"localStorage"!==e){const{useCamelCaseFlagKeys:t}=this.getReactOptions();this.state={flags:t?p(e):e,unproxiedFlags:e,flagKeyMap:{},ldClient:void 0}}}}componentDidMount(){return M(this,null,(function*(){const{deferInitialization:e}=this.props;e&&!u(this.props)||(yield this.initLDClient())}))}componentDidUpdate(e){return M(this,null,(function*(){const{deferInitialization:t}=this.props,r=!u(e)&&u(this.props);t&&r&&(yield this.initLDClient())}))}render(){const{flags:t,flagKeyMap:r,ldClient:n,error:o}=this.state;return e.createElement(l,{value:{flags:t,flagKeyMap:r,ldClient:n,error:o}},this.props.children)}}var q=Object.defineProperty,z=Object.defineProperties,T=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertySymbols,$=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable,U=(e,t,r)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,W=(e,t)=>{for(var r in t||(t={}))$.call(t,r)&&U(e,r,t[r]);if(V)for(var r of V(t))N.call(t,r)&&U(e,r,t[r]);return e};var A=Object.defineProperty,B=Object.getOwnPropertySymbols,G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,J=(e,t,r)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Q=(e,t)=>{for(var r in t||(t={}))G.call(t,r)&&J(e,r,t[r]);if(B)for(var r of B(t))H.call(t,r)&&J(e,r,t[r]);return e};var X=Object.defineProperty,Y=Object.getOwnPropertySymbols,Z=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable,ee=(e,t,r)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,te=(e,t)=>{for(var r in t||(t={}))Z.call(t,r)&&ee(e,r,t[r]);if(Y)for(var r of Y(t))_.call(t,r)&&ee(e,r,t[r]);return e};exports.LDProvider=R,exports.asyncWithLDProvider=function(t){return r=this,n=null,o=function*(){const{clientSideID:r,flags:n,options:o,reactOptions:s}=t,i=Q(Q({},a),s),{ldClient:c,flags:p,error:y}=yield j(r,u(t),o,n),d=(null==o?void 0:o.bootstrap)&&"localStorage"!==o.bootstrap?o.bootstrap:p;return({children:t})=>{const[r,o]=e.useState((()=>Q({unproxiedFlags:d},C(c,d,i,n))));e.useEffect((()=>{function e(e){const t=f(e,n);Object.keys(t).length>0&&o((({unproxiedFlags:e})=>{const r=Q(Q({},e),t);return Q({unproxiedFlags:r},C(c,r,i,n))}))}return c.on("change",e),function(){c.off("change",e)}}),[]);const{flags:s,flagKeyMap:a}=r;return e.createElement(l,{value:{flags:s,flagKeyMap:a,ldClient:c,error:y}},t)}},new Promise(((e,t)=>{var s=e=>{try{i(o.next(e))}catch(e){t(e)}},a=e=>{try{i(o.throw(e))}catch(e){t(e)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(s,a);i((o=o.apply(r,n)).next())}));var r,n,o},exports.camelCaseKeys=p,exports.defaultReactOptions=a,exports.useFlags=()=>{const{flags:t}=e.useContext(i);return t},exports.useLDClient=()=>{const{ldClient:t}=e.useContext(i);return t},exports.useLDClientError=function(){const{error:t}=e.useContext(i);return t},exports.withLDConsumer=function(e={clientOnly:!1}){return function(t){return r=>s.createElement(c,null,(({flags:n,ldClient:o})=>e.clientOnly?s.createElement(t,te({ldClient:o},r)):s.createElement(t,te({flags:n,ldClient:o},r))))}},exports.withLDProvider=function(e){return function(t){const{reactOptions:r}=e,o=W(W({},a),r),i=(l=W({},e),z(l,T({reactOptions:o})));var l;function c(e){return s.createElement(R,W({},i),s.createElement(t,W({},e)))}return n(c,t),c}},Object.keys(t).forEach((function(e){"default"===e||Object.prototype.hasOwnProperty.call(exports,e)||Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})}));
//# sourceMappingURL=index.js.map
